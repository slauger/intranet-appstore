
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Intranet AppStore</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" />
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <style>
    :root { color-scheme: light; }
    html, body { height: 100%; margin: 0; }
    body { background: #ffffff; font-family: Inter, system-ui, sans-serif; background-size: cover; background-position: center; }
    .muted { color: rgba(0,0,0,0.6); }
  </style>
</head>
<body class="text-black">
  <header class="mx-auto max-w-7xl px-4 pb-6 pt-10 sm:px-6 lg:px-8">
    <div class="flex flex-col gap-6 md:flex-row md:items-end md:justify-between">
      <div>
        <h1 class="text-3xl font-extrabold tracking-tight sm:text-4xl" id="title">Intranet AppStore</h1>
        <p class="mt-1 muted" id="subtitle"></p>
      </div>
      <div class="flex flex-wrap items-center gap-2">
        <div class="relative">
          <input id="search" type="search" placeholder="Suchen…" class="w-64 rounded-full border border-black/20 bg-black/5 px-4 py-2 pl-10 outline-none focus:ring-2 focus:ring-black" />
          <span class="pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 opacity-70">⌕</span>
        </div>
        <select id="category" class="rounded-full border border-black/20 bg-black/5 px-3 py-2 outline-none focus:ring-2 focus:ring-black"></select>
        <select id="background" class="rounded-full border border-black/20 bg-black/5 px-3 py-2 outline-none focus:ring-2 focus:ring-black"></select>
      </div>
    </div>
  </header>

  <main class="mx-auto max-w-7xl px-4 pb-16 sm:px-6 lg:px-8">
    <section id="featured-section" class="hidden">
      <h2 class="text-xl font-bold mb-3 mt-6">Empfohlen</h2>
      <div id="featured" class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3"></div>
    </section>

    <section>
      <h2 class="text-xl font-bold mb-3 mt-6">Favoriten</h2>
      <div id="favorites" class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"></div>
      <p id="no-favs" class="muted">Noch keine Favoriten. Über einer Kachel ☆ anklicken.</p>
    </section>

    <section>
      <h2 class="text-xl font-bold mb-3 mt-6">Alle Apps</h2>
      <div id="all" class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"></div>
      <p id="no-all" class="mt-4 muted hidden">Keine Ergebnisse.</p>
    </section>
  </main>

  <script>
    const LS_FAVS = "intranet_appstore_favorites_v1";
    const LS_BG = "intranet_appstore_bg";
    const state = { config: null, favorites: JSON.parse(localStorage.getItem(LS_FAVS) || "[]"), query: "", category: "Alle", background: localStorage.getItem(LS_BG) || null };
    const $ = id => document.getElementById(id);

    function allLinks() {
      const items = [];
      (state.config.categories || []).forEach(cat => (cat.links||[]).forEach(link => items.push(Object.assign({_category: cat.name}, link))));
      return items;
    }
    function applyFilters(items) {
      const q = state.query.trim().toLowerCase();
      return items.filter(l => {
        const inCat = state.category === "Alle" || l._category === state.category;
        const txt = (l.title + " " + (l.description||"") + " " + (l.tags||[]).join(" ")).toLowerCase();
        return inCat && (!q || txt.includes(q));
      });
    }
    function isFA(spec) { return typeof spec === "string" && spec.includes("fa-"); }
    function iconNode(spec) {
      if (isFA(spec)) { const i = document.createElement("i"); i.className = spec; return i; }
      const span = document.createElement("span");
      const name = (typeof spec === "string" && spec) ? spec : "Globe";
      try { const iconName = lucide.icons[name] ? name : "Globe"; span.innerHTML = lucide.createElement(iconName, { size: 20, color: "currentColor" }).outerHTML; }
      catch { span.textContent = "•"; }
      return span;
    }
    function card(link) {
      const a = document.createElement("a");
      a.href = link.url; a.target = "_blank"; a.rel = "noreferrer";
      a.className = "group relative block rounded-2xl border border-black/15 bg-white/80 p-4 backdrop-blur-md hover:border-black/30 hover:bg-white";
      const favBtn = document.createElement("button");
      favBtn.type = "button";
      favBtn.textContent = state.favorites.includes(link.title) ? "★" : "☆";
      favBtn.className = "absolute right-3 top-3 text-sm text-black/70";
      favBtn.addEventListener("click", (e) => {
        e.preventDefault();
        const idx = state.favorites.indexOf(link.title);
        if (idx >= 0) state.favorites.splice(idx,1); else state.favorites.push(link.title);
        localStorage.setItem(LS_FAVS, JSON.stringify(state.favorites));
        render();
      });
      a.appendChild(favBtn);

      const row = document.createElement("div");
      row.className = "flex items-start gap-3";

      const iconBox = document.createElement("div");
      iconBox.className = "grid h-12 w-12 place-items-center rounded-xl bg-black/10";
      iconBox.appendChild(iconNode(link.icon));

      const textBox = document.createElement("div");
      textBox.className = "min-w-0";

      const titleRow = document.createElement("div");
      titleRow.className = "flex items-center gap-2";
      const h3 = document.createElement("h3");
      h3.className = "truncate text-lg font-semibold";
      h3.textContent = link.title;
      titleRow.appendChild(h3);
      (link.tags||[]).slice(0,2).forEach(t=>{
        const pill = document.createElement("span");
        pill.className = "rounded-full bg-black/10 px-2 py-0.5 text-[10px] uppercase tracking-wide text-black/70";
        pill.textContent = t; titleRow.appendChild(pill);
      });

      textBox.appendChild(titleRow);

      if (link.description) {
        const p = document.createElement("p");
        p.className = "mt-1 text-sm text-black/70";
        p.textContent = link.description;
        textBox.appendChild(p);
      }

      const cat = document.createElement("p");
      cat.className = "mt-2 text-xs text-black/50";
      cat.textContent = link._category;
      textBox.appendChild(cat);

      row.appendChild(iconBox);
      row.appendChild(textBox);
      a.appendChild(row);

      const foot = document.createElement("div");
      foot.className = "mt-4 flex items-center justify-between";
      const host = document.createElement("span");
      host.className = "text-xs text-black/60";
      try { host.textContent = new URL(link.url).hostname; } catch { host.textContent = link.url; }
      const open = document.createElement("span");
      open.className = "rounded-lg bg-black/10 px-3 py-1 text-xs";
      open.textContent = "Öffnen";
      foot.appendChild(host); foot.appendChild(open);
      a.appendChild(foot);

      return a;
    }
    function applyBackground(file) {
      if (!file) { document.body.style.backgroundImage = ""; document.body.style.background = "#ffffff"; }
      else { document.body.style.backgroundImage = `url('${file}')`; document.body.style.backgroundSize = "cover"; document.body.style.backgroundPosition = "center"; }
    }
    function render() {
      $("title").textContent = state.config.title || "Intranet AppStore";
      $("subtitle").textContent = state.config.subtitle || "";
      const categories = ["Alle", ...Array.from(new Set((state.config.categories||[]).map(c=>c.name)))];
      const sel = $("category"); sel.innerHTML = "";
      categories.forEach(c=>{ const opt=document.createElement("option"); opt.value=c; opt.textContent=c; sel.appendChild(opt); });
      sel.value = state.category;
      const items = applyFilters(allLinks());
      const favSet = new Set(state.favorites);
      const favs = items.filter(l => favSet.has(l.title));
      const others = items.filter(l => !favSet.has(l.title));
      const favWrap = $("favorites"); favWrap.innerHTML=""; favs.forEach(l => favWrap.appendChild(card(l)));
      $("no-favs").style.display = favs.length ? "none" : "block";
      const allWrap = $("all"); allWrap.innerHTML=""; others.forEach(l => allWrap.appendChild(card(l)));
      $("no-all").classList.toggle("hidden", others.length !== 0);
      const featuredSet = new Set(state.config.featured || []);
      const featured = allLinks().filter(l => featuredSet.has(l.title));
      const featSec = $("featured-section"); const featWrap = $("featured");
      if (featured.length) { featSec.classList.remove("hidden"); featWrap.innerHTML=""; featured.forEach(l => featWrap.appendChild(card(l))); }
      else { featSec.classList.add("hidden"); }
      // Background select
      const bgSel = $("background"); bgSel.innerHTML="";
      (state.config.backgrounds || []).forEach(bg=>{
        const opt=document.createElement("option"); opt.value=bg.file; opt.textContent=bg.name; bgSel.appendChild(opt);
      });
      let bgFile = state.background;
      if (!bgFile) {
        const def = (state.config.backgrounds||[]).find(b=>b.name===state.config.defaultBackground);
        bgFile = def ? def.file : "";
      }
      bgSel.value = bgFile;
      applyBackground(bgFile);
    }
    $("search").addEventListener("input", e=>{state.query=e.target.value; render();});
    $("category").addEventListener("change", e=>{state.category=e.target.value; render();});
    $("background").addEventListener("change", e=>{ state.background = e.target.value; localStorage.setItem(LS_BG, state.background); applyBackground(state.background); });
    fetch("./intranet_config.json", { cache:"no-cache" })
      .then(r=>r.json()).then(cfg=>{ state.config=cfg; render(); });
  </script>
</body>
</html>
